// 添加错误处理
$(document).ready(function() {
    try {
        // 原有代码
        
        // 轮播图功能
        let currentSlide = 0;
        const slides = $('.slide');
        const dots = $('.dot');
        const totalSlides = slides.length;
        
        // 重新定义轮播显示函数
        function showSlide(index) {
            if (index >= totalSlides) currentSlide = 0;
            if (index < 0) currentSlide = totalSlides - 1;
            
            // 使用正确的CSS变换方式
            $('.slider').css('transform', `translateX(-${currentSlide * 100}%)`);
            dots.removeClass('active');
            $(dots[currentSlide]).addClass('active');
        }
        
        // 立即调用一次确保初始化正确
        showSlide(0);
        
        // 自动轮播
        let slideInterval = setInterval(() => {
            currentSlide++;
            showSlide(currentSlide);
        }, 5000);
        
        // 点击箭头切换
        $('.next').click(function() {
            clearInterval(slideInterval);
            currentSlide++;
            showSlide(currentSlide);
            slideInterval = setInterval(() => {
                currentSlide++;
                showSlide(currentSlide);
            }, 5000);
        });
        
        $('.prev').click(function() {
            clearInterval(slideInterval);
            currentSlide--;
            showSlide(currentSlide);
            slideInterval = setInterval(() => {
                currentSlide++;
                showSlide(currentSlide);
            }, 5000);
        });
        
        // 点击指示点切换
        dots.each(function(index) {
            $(this).click(function() {
                clearInterval(slideInterval);
                currentSlide = index;
                showSlide(currentSlide);
                slideInterval = setInterval(() => {
                    currentSlide++;
                    showSlide(currentSlide);
                }, 5000);
            });
        });
        
        // 招生按钮点击事件
        $('.admission-btn').click(function() {
            alert('报名系统正在维护中，请稍后再试或拨打招生热线！');
        });
        
        // 添加新闻标签切换功能
        $('.news-tabs .tab').click(function() {
            const tabIndex = $(this).index();
            $('.news-tabs .tab').removeClass('active');
            $(this).addClass('active');
            
            if (tabIndex === 0) {
                $('.news-list.notices').hide();
                $('.news-list.news').show();
            } else {
                $('.news-list.news').hide();
                $('.news-list.notices').show();
            }
        });
        
        // 修改导航链接点击事件
        $('.nav-link').click(function(e) {
            e.preventDefault();
            // 导航链接处理其他逻辑，不打开新闻模态框
            const modalType = $(this).data('modal');
            if (modalType) {
                // 这里可以处理导航链接特定的逻辑
                console.log("导航链接点击: " + modalType);
                // 如果需要，可以打开其他类型的模态框
            }
        });
        
        // 新闻链接点击事件
        $('.news-link, .read-more').click(function(e) {
            e.preventDefault();
            const modalId = $(this).data('modal');
            if (modalId) {
                // 先显示模态框容器
                $('.modal-container').fadeIn(300);
                // 再显示特定模态框
                $(`#${modalId}-modal`).fadeIn(300);
                $('body').addClass('modal-open');
            }
        });
        
        // 确保关闭按钮正确绑定
        $('.close-btn, .modal-container').click(function(e) {
            if (e.target === this || $(this).hasClass('close-btn')) {
                $('.modal, .modal-container').fadeOut(300);
                $('body').removeClass('modal-open');
            }
        });
        
        // 阻止点击模态框内容时关闭
        $('.modal-content').click(function(e) {
            e.stopPropagation();
        });
        
        // 添加滚动导航功能
        const sections = ['.hero-section', '.features', '.campus-gallery', '.admission', 'footer'];
        const $body = $('body');
        
        // 创建滚动导航
        const $scrollNav = $('<div class="scroll-nav"></div>');
        sections.forEach((section, index) => {
            $scrollNav.append(`<div class="scroll-nav-dot" data-index="${index}"></div>`);
        });
        $body.append($scrollNav);
        
        // 点击滚动到对应部分
        $('.scroll-nav-dot').click(function() {
            const index = $(this).data('index');
            const $target = $(sections[index]);
            
            $('html, body').animate({
                scrollTop: $target.offset().top
            }, 800);
        });
        
        // 监听滚动位置更新导航点状态
        $(window).scroll(function() {
            const scrollTop = $(window).scrollTop();
            const windowHeight = $(window).height();
            
            sections.forEach((section, index) => {
                const $section = $(section);
                const sectionTop = $section.offset().top;
                const sectionHeight = $section.outerHeight();
                
                if (scrollTop >= sectionTop - windowHeight/2 && 
                    scrollTop < sectionTop + sectionHeight - windowHeight/2) {
                    $('.scroll-nav-dot').removeClass('active');
                    $(`.scroll-nav-dot[data-index="${index}"]`).addClass('active');
                }
            });
        });
        
        // 初始化触发一次滚动事件以更新导航状态
        $(window).trigger('scroll');
        
        // 确保每个模块在加载后都能正确适应视口高度
        function adjustModuleHeights() {
            const windowHeight = $(window).height();
            
            // 调整轮播图高度
            $('.slider-container').css('height', windowHeight - 300 + 'px');
            
            // 调整特色区域高度
            $('.features-grid').css('height', windowHeight - 200 + 'px');
            
            // 调整校园风光图片高度
            $('.gallery-item img').css('height', (windowHeight - 350) / 2 + 'px');
            
            // 调整招生信息内容高度
            $('.admission-content').css('height', windowHeight - 250 + 'px');
        }
        
        // 页面加载和窗口大小变化时调整高度
        $(window).on('load resize', function() {
            if ($(window).width() > 992) {
                adjustModuleHeights();
            } else {
                // 在移动设备上重置高度
                $('.slider-container, .features-grid, .gallery-item img, .admission-content')
                    .css('height', 'auto');
            }
        });
        
        // 轮播图优化
        function enhanceSlider() {
            const slides = $('.slide');
            const dots = $('.dot');
            let currentIndex = 0;
            let slideInterval;
            
            // 初始化轮播图
            function initSlider() {
                slides.removeClass('active');
                $(slides[currentIndex]).addClass('active');
                dots.removeClass('active');
                $(dots[currentIndex]).addClass('active');
                
                // 添加轮播图文字说明
                slides.each(function(index) {
                    const $this = $(this);
                    let caption;
                    
                    if (index === 0) {
                        caption = '<div class="slide-caption"><h3>欢迎来到淄博齐盛高级中学</h3><p>与淄博实验中学同根同脉，共创教育辉煌</p></div>';
                    } else if (index === 1) {
                        caption = '<div class="slide-caption"><h3>多彩校园活动</h3><p>丰富多彩的学生活动，培养全面发展人才</p></div>';
                    } else {
                        caption = '<div class="slide-caption"><h3>优秀师资团队</h3><p>优秀的教师团队，成就学生卓越未来</p></div>';
                    }
                    
                    if (!$this.find('.slide-caption').length) {
                        $this.append(caption);
                    }
                });
            }
            
            // 切换到指定幻灯片
            function goToSlide(index) {
                currentIndex = index;
                if (currentIndex >= slides.length) currentIndex = 0;
                if (currentIndex < 0) currentIndex = slides.length - 1;
                
                slides.removeClass('active');
                $(slides[currentIndex]).addClass('active');
                dots.removeClass('active');
                $(dots[currentIndex]).addClass('active');
            }
            
            // 自动播放
            function startAutoSlide() {
                slideInterval = setInterval(() => {
                    goToSlide(currentIndex + 1);
                }, 5000);
            }
            
            // 初始化和绑定事件
            initSlider();
            startAutoSlide();
            
            // 点击箭头切换
            $('.arrow.next').click(function() {
                clearInterval(slideInterval);
                goToSlide(currentIndex + 1);
                startAutoSlide();
            });
            
            $('.arrow.prev').click(function() {
                clearInterval(slideInterval);
                goToSlide(currentIndex - 1);
                startAutoSlide();
            });
            
            // 点击指示点切换
            dots.each(function(index) {
                $(this).click(function() {
                    clearInterval(slideInterval);
                    goToSlide(index);
                    startAutoSlide();
                });
            });
            
            // 鼠标悬停暂停自动播放
            $('.slider-container').hover(
                function() { clearInterval(slideInterval); },
                function() { startAutoSlide(); }
            );
        }
        
        // 调用轮播优化
        enhanceSlider();
        
    } catch(e) {
        console.log("加载出错:", e);
    }
}); 